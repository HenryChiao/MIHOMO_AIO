# Mihomo é…ç½®ä»å…¥é—¨åˆ°è¿›é˜¶ï¼šä¸‰é˜¶æ®µå®Œå…¨æ•™ç¨‹

> å‚è€ƒèµ„æ–™ï¼š[è™šç©ºç»ˆç«¯ Docs](https://wiki.metacubex.one/config/) Â· [å®˜æ–¹ config.yaml](https://github.com/MetaCubeX/mihomo/blob/Alpha/docs/config.yaml) Â· [HenryChiao YAMLS é…ç½®åˆé›†](https://github.com/HenryChiao/MIHOMO_YAMLS)

---

## å†™åœ¨æœ€å‰ï¼šä»€ä¹ˆæ˜¯ mihomoï¼Ÿ

Mihomoï¼ˆåŸå Clash Metaï¼‰æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€ç¼–å†™çš„é«˜æ€§èƒ½ç½‘ç»œä»£ç†å†…æ ¸ï¼Œæ˜¯ç›®å‰åŠŸèƒ½æœ€ä¸°å¯Œã€ç¤¾åŒºæœ€æ´»è·ƒçš„ Clash è¡ç”Ÿç‰ˆæœ¬ä¹‹ä¸€ã€‚å®ƒæœ¬èº«æ˜¯ä¸€ä¸ªæ²¡æœ‰å›¾å½¢ç•Œé¢çš„å‘½ä»¤è¡Œç¨‹åºï¼Œé€šè¿‡è¯»å–ä¸€ä»½ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶æ¥å·¥ä½œã€‚

**YAML æ˜¯ä»€ä¹ˆï¼Ÿ** æ˜¯ä¸€ç§"äººç±»å¯è¯»çš„æ•°æ®æ ¼å¼"ï¼Œé ç¼©è¿›è¡¨è¾¾å±‚çº§å…³ç³»ï¼Œå†’å·åé¢è·Ÿå€¼ï¼Œ`-` å¼€å¤´è¡¨ç¤ºåˆ—è¡¨é¡¹ï¼Œ`#` å¼€å¤´æ˜¯æ³¨é‡Šã€‚**ç»å¯¹ä¸èƒ½ç”¨ Tab ç¼©è¿›ï¼Œåªèƒ½ç”¨ç©ºæ ¼ã€‚** è¿™æ˜¯ YAML æœ€å¸¸è§çš„å‘ï¼Œè¯·ç‰¢è®°ã€‚

---

# ç¬¬ä¸€é˜¶æ®µï¼šå°ç™½ç¯‡ â€”â€” è·‘èµ·æ¥å°±æ˜¯èƒœåˆ©

è¿™ä¸€é˜¶æ®µçš„ç›®æ ‡åªæœ‰ä¸€ä¸ªï¼š**å†™å‡ºä¸€ä»½èƒ½è®© mihomo æ­£å¸¸å¯åŠ¨çš„æœ€å°å¯ç”¨é…ç½®**ï¼Œç†è§£æ¯ä¸€è¡Œåœ¨åšä»€ä¹ˆï¼Œä¸ç•™ä»»ä½•"ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦å†™è¿™è¡Œ"çš„æ­»è§’ã€‚

---

## 1.1 ä¸€ä»½é…ç½®æ–‡ä»¶çš„æ•´ä½“ç»“æ„

ä¸€ä»½ mihomo é…ç½®æ–‡ä»¶ç”±ä»¥ä¸‹å‡ ä¸ªä¸»è¦æ¿å—ç»„æˆï¼Œé¡ºåºä¸å¼ºåˆ¶ï¼Œä½†çº¦å®šä¿—æˆåœ°æŒ‰ä»¥ä¸‹é¡ºåºä¹¦å†™ï¼š

```
å…¨å±€è®¾ç½®ï¼ˆç«¯å£ã€æ¨¡å¼ã€æ—¥å¿—ç­‰ï¼‰
  â†“
DNS é…ç½®
  â†“
åŸŸåå—…æ¢ï¼ˆSniffï¼‰
  â†“
å…¥ç«™ï¼ˆTun / ç«¯å£ï¼‰
  â†“
å‡ºç«™ä»£ç†ï¼ˆproxiesï¼‰â€”â€” ä½ çš„èŠ‚ç‚¹åˆ—è¡¨
  â†“
ä»£ç†æä¾›è€…ï¼ˆproxy-providersï¼‰â€”â€” è®¢é˜…é“¾æ¥ï¼ˆå¯é€‰ï¼‰
  â†“
ä»£ç†ç»„ï¼ˆproxy-groupsï¼‰â€”â€” é€‰å“ªä¸ªèŠ‚ç‚¹çš„ç­–ç•¥
  â†“
è§„åˆ™æä¾›è€…ï¼ˆrule-providersï¼‰â€”â€” è§„åˆ™é›†è®¢é˜…ï¼ˆå¯é€‰ï¼‰
  â†“
è·¯ç”±è§„åˆ™ï¼ˆrulesï¼‰â€”â€” ä»€ä¹ˆæµé‡èµ°å“ªé‡Œ
```

ä¸‹é¢æˆ‘ä»¬é€å—è®²è§£ï¼Œå¹¶ç»™å‡ºæœ€å°å¯ç”¨ç¤ºä¾‹ã€‚

---

## 1.2 å…¨å±€è®¾ç½®

```yaml
# â”€â”€ ä»£ç†ç«¯å£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
mixed-port: 7890          # åŒæ—¶æ”¯æŒ HTTP å’Œ SOCKS5 çš„æ··åˆç«¯å£ï¼Œæ¨èä½¿ç”¨è¿™ä¸ª
# port: 7890              # çº¯ HTTP ä»£ç†ç«¯å£ï¼ˆå’Œ mixed-port äºŒé€‰ä¸€å³å¯ï¼‰
# socks-port: 7891        # çº¯ SOCKS5 ä»£ç†ç«¯å£

# â”€â”€ å±€åŸŸç½‘è®¿é—® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
allow-lan: false          # æ˜¯å¦å…è®¸å±€åŸŸç½‘å†…å…¶ä»–è®¾å¤‡è¿æ¥æœ¬æœºä»£ç†
                          # å®¶ç”¨ä¸ªäººç”µè„‘é€šå¸¸è®¾ä¸º falseï¼›è½¯è·¯ç”±/å…±äº«ä»£ç†è®¾ä¸º true
bind-address: "*"         # allow-lan ä¸º true æ—¶ç”Ÿæ•ˆï¼Œ* è¡¨ç¤ºç»‘å®šæ‰€æœ‰ç½‘å¡

# â”€â”€ è¿è¡Œæ¨¡å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
mode: rule                # rule=æŒ‰è§„åˆ™åˆ†æµï¼ˆæ¨èï¼‰; global=å…¨èµ°ä»£ç†; direct=å…¨èµ°ç›´è¿

# â”€â”€ æ—¥å¿—çº§åˆ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
log-level: info           # å¯é€‰ï¼šsilent / error / warning / info / debug
                          # è°ƒè¯•é—®é¢˜æ—¶æ”¹ä¸º debugï¼Œæ—¥å¸¸ç”¨ info æˆ– warning

# â”€â”€ è¿›ç¨‹åŒ¹é… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
find-process-mode: strict # strict=è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦åŒ¹é…è¿›ç¨‹; always=å¼ºåˆ¶; off=ä¸åŒ¹é…ï¼ˆè·¯ç”±å™¨æ¨èï¼‰

# â”€â”€ IPv6 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ipv6: false               # æ˜¯å¦å…è®¸ IPv6 æµé‡ï¼ˆæ–°æ‰‹å»ºè®® falseï¼Œé¿å…å¤æ‚é—®é¢˜ï¼‰

# â”€â”€ å¤–éƒ¨æ§åˆ¶ï¼ˆWeb UI / APIï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
external-controller: 127.0.0.1:9090   # REST API åœ°å€ï¼ŒWeb é¢æ¿é è¿™ä¸ªè¿
# secret: "your_password"             # API è®¿é—®å¯†é’¥ï¼Œå…¬ç½‘æš´éœ²æ—¶åŠ¡å¿…è®¾ç½®
external-ui: ui                       # Web UI æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼ˆç›¸å¯¹äºé…ç½®æ–‡ä»¶ç›®å½•ï¼‰
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"
# é¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨ä¸‹è½½ Web UIï¼Œä¹‹åå¯åœ¨æµè§ˆå™¨è®¿é—® http://127.0.0.1:9090/ui

# â”€â”€ GeoData æ•°æ®åº“åœ°å€ï¼ˆå¯é€‰ï¼Œç”¨äº GEO è§„åˆ™ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
geox-url:
  geoip: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"
  asn: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/GeoLite2-ASN.mmdb"

# â”€â”€ é…ç½®æŒä¹…åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
profile:
  store-selected: true    # è®°ä½ä½ åœ¨ Web UI ä¸­æ‰‹åŠ¨é€‰æ‹©çš„èŠ‚ç‚¹ï¼Œé‡å¯åä¸ä¼šé‡ç½®
  store-fake-ip: true     # æŒä¹…åŒ– fake-ip æ˜ å°„è¡¨ï¼ˆé…åˆ DNS fake-ip æ¨¡å¼ä½¿ç”¨ï¼‰
```

**å°ç™½è¦ç‚¹ï¼š**

- `mixed-port: 7890` æ˜¯æœ€å¸¸ç”¨çš„å†™æ³•ï¼Œä¸€ä¸ªç«¯å£æå®š HTTP å’Œ SOCKS5ã€‚
- `mode: rule` æ˜¯æ—¥å¸¸ä½¿ç”¨çš„æ¨¡å¼ï¼Œåé¢ä¼šé…ç½®è§„åˆ™æ¥å†³å®šå“ªäº›æµé‡èµ°ä»£ç†ã€å“ªäº›ç›´è¿ã€‚
- `external-controller` æ˜¯è¿æ¥ Web é¢æ¿ï¼ˆå¦‚ metacubexdã€yacdï¼‰çš„æ¥å£ï¼Œæ–°æ‰‹å¼ºçƒˆå»ºè®®æ‰“å¼€ï¼Œæ–¹ä¾¿å¯è§†åŒ–ç®¡ç†ã€‚

---

## 1.3 DNS é…ç½®

DNS æ˜¯å¾ˆå¤šäººé…ç½® mihomo æ—¶æœ€å®¹æ˜“æé”™çš„éƒ¨åˆ†ï¼Œä½†ç†è§£åŸç†åå…¶å®å¹¶ä¸å¤æ‚ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦é…ç½® DNSï¼Ÿ

å½“ä½ è®¿é—® `google.com` æ—¶ï¼Œç³»ç»Ÿéœ€è¦å…ˆæŠŠåŸŸåè§£ææˆ IP åœ°å€ã€‚å¦‚æœç”¨ç³»ç»Ÿé»˜è®¤çš„ DNSï¼ˆæ¯”å¦‚è¿è¥å•†çš„ DNSï¼‰ï¼Œåœ¨ä¸­å›½å¤§é™†ä¼šé‡åˆ° DNS æ±¡æŸ“ï¼Œå¯¼è‡´è§£æåˆ°é”™è¯¯çš„ IPï¼Œè¿›è€Œå¯¼è‡´ä»£ç†å¤±æ•ˆæˆ–æµé‡ç»•è¿‡ä»£ç†ç›´è¿å¤±è´¥ã€‚

mihomo å†…ç½®äº†ä¸€ä¸ª DNS æœåŠ¡å™¨ï¼Œè´Ÿè´£æ‹¦æˆªæ‰€æœ‰ DNS è¯·æ±‚å¹¶æŒ‰è§„åˆ™å¤„ç†ï¼Œè¿™æ ·å¯ä»¥åšåˆ°ï¼š
1. å›½å†…åŸŸåèµ°å›½å†… DNSï¼Œè§£æåˆ°æœ€ä¼˜ IPã€‚
2. å›½å¤–åŸŸåèµ°ä»£ç† DNSï¼ˆå¦‚ 8.8.8.8 via ä»£ç†èŠ‚ç‚¹ï¼‰ï¼Œå¾—åˆ°æ­£ç¡®çš„æœªæ±¡æŸ“ IPã€‚
3. é…åˆ fake-ip æ¨¡å¼ï¼Œè®©ä»£ç†è§„åˆ™èƒ½åœ¨ DNS è§£æä¹‹å‰å°±ç”Ÿæ•ˆã€‚

### æœ€å°å¯ç”¨ DNS é…ç½®ï¼ˆæ–°æ‰‹æ¨èï¼‰

```yaml
dns:
  enable: true            # å¿…é¡»å¼€å¯ï¼Œå¦åˆ™ DNS åŠŸèƒ½ä¸ç”Ÿæ•ˆ
  listen: 0.0.0.0:1053    # mihomo å†…ç½® DNS æœåŠ¡å™¨ç›‘å¬åœ°å€ï¼ˆç«¯å£å¯è‡ªå®šä¹‰ï¼‰
  ipv6: false             # å…³é—­ IPv6 è§£æï¼ˆæ–°æ‰‹å»ºè®®å…³é—­ï¼‰

  # â”€â”€ è§£ææ¨¡å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  enhanced-mode: fake-ip  # æ¨è fake-ip æ¨¡å¼ï¼ˆè§ä¸‹æ–¹è¯´æ˜ï¼‰
                          # å¤‡é€‰ï¼šredir-hostï¼ˆå…¼å®¹æ€§æ›´å¥½ï¼Œä½†æ€§èƒ½ç•¥å·®ï¼‰

  fake-ip-range: 198.18.0.1/16  # fake-ip åˆ†é…æ± ï¼Œä¿æŒé»˜è®¤å³å¯

  # fake-ip ç™½åå•ï¼šè¿™äº›åŸŸåä¸ä½¿ç”¨ fake-ipï¼Œç›´æ¥æ­£å¸¸è§£æ
  # ä¸»è¦æ˜¯å±€åŸŸç½‘æœåŠ¡å’Œä¸€äº›ç‰¹æ®Šåœºæ™¯
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - localhost.ptlogin2.qq.com
    - "+.stun.*.*"
    - "+.stun.*.*.*"

  # â”€â”€ ä¸Šæ¸¸ DNS æœåŠ¡å™¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # nameserver ç”¨äºè§£æå›½å†…åŸŸåï¼ˆç›´è¿èµ°çš„ DNSï¼‰
  nameserver:
    - 223.5.5.5            # é˜¿é‡Œ DNS
    - 119.29.29.29         # è…¾è®¯ DNS
    - system               # ä½¿ç”¨ç³»ç»Ÿ DNS ä½œä¸ºå¤‡é€‰

  # fallback ç”¨äºè§£æå›½å¤–åŸŸåï¼ˆé€šè¿‡ä»£ç†èµ°çš„ DNSï¼‰
  fallback:
    - tls://8.8.8.8:853         # Google DoT
    - tls://1.1.1.1:853         # Cloudflare DoT
    - https://dns.google/dns-query  # Google DoH

  # å½“ fallback ä¸­è§£æåˆ°å›½å¤– IP æ—¶ï¼Œæ‰ä½¿ç”¨ fallback çš„ç»“æœ
  # å¦åˆ™ä¼˜å…ˆä½¿ç”¨ nameserver çš„ç»“æœï¼ˆé˜²æ­¢å›½å†… IP è¢« fallback ç»•é“è§£æå˜æ…¢ï¼‰
  fallback-filter:
    geoip: true            # è§£æç»“æœæ˜¯å›½å¤– IP â†’ ç”¨ fallback
    geoip-code: CN         # å›½å†… IP â†’ ç”¨ nameserver
    ipcidr:                # è¿™äº› IP æ®µè§†ä¸ºè¢«æ±¡æŸ“ï¼Œå¼ºåˆ¶èµ° fallback
      - 240.0.0.0/4
```

**ä»€ä¹ˆæ˜¯ fake-ipï¼Ÿ**

åœ¨ `fake-ip` æ¨¡å¼ä¸‹ï¼Œå½“ä½ çš„åº”ç”¨å‘èµ· DNS æŸ¥è¯¢æ—¶ï¼Œmihomo ä¼šç«‹åˆ»è¿”å›ä¸€ä¸ªå‡çš„ IPï¼ˆä» `fake-ip-range` æ± é‡Œå–ä¸€ä¸ªï¼Œå¦‚ `198.18.0.1`ï¼‰ï¼Œç„¶ååœ¨å†…éƒ¨å»ºç«‹è¿™ä¸ªå‡ IP ä¸çœŸå®åŸŸåçš„æ˜ å°„ã€‚å½“æµé‡å‘åˆ°è¿™ä¸ªå‡ IP æ—¶ï¼Œmihomo çŸ¥é“å®ƒå¯¹åº”çš„æ˜¯å“ªä¸ªåŸŸåï¼Œå°±å¯ä»¥æŒ‰ç…§åŸŸåè§„åˆ™æ¥å†³å®šèµ°ä»£ç†è¿˜æ˜¯ç›´è¿ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚

**ä»€ä¹ˆæ˜¯ redir-hostï¼Ÿ**

`redir-host` æ¨¡å¼ä¼šå…ˆçœŸæ­£åœ° DNS è§£æï¼Œç­‰æ‹¿åˆ°çœŸå® IP ä¹‹åå†æ ¹æ® IP æ¥åˆ¤æ–­èµ°ä»£ç†è¿˜æ˜¯ç›´è¿ã€‚å…¼å®¹æ€§æ›´å¥½ï¼Œä½†æ¯æ¬¡è¿æ¥éƒ½è¦ç­‰ DNS è§£æå®Œæˆï¼Œé€Ÿåº¦ç•¥æ…¢ï¼Œä¸”å¯èƒ½å—åˆ° DNS æ±¡æŸ“å½±å“ã€‚

æ–°æ‰‹æ¨è `fake-ip`ï¼Œé‡åˆ°ç‰¹æ®Šè½¯ä»¶ï¼ˆå¦‚æŸäº›æ¸¸æˆï¼‰ä¸å…¼å®¹æ—¶å†è€ƒè™‘åˆ‡æ¢ä¸º `redir-host`ã€‚

---

## 1.4 åŸŸåå—…æ¢ï¼ˆSniffï¼‰

```yaml
sniffer:
  enable: true
  # å—…æ¢ç»“æœè¦†ç›–è¿æ¥çš„ç›®æ ‡åœ°å€
  # åœ¨ TUN/é€æ˜ä»£ç†æ¨¡å¼ä¸‹å°¤å…¶é‡è¦
  # å› ä¸º TUN æ¨¡å¼æ‹¿åˆ°çš„æ˜¯ IPï¼Œå—…æ¢åæ‰èƒ½çŸ¥é“çœŸå®åŸŸåï¼Œä»è€Œç”¨åŸŸåè§„åˆ™åŒ¹é…
  override-destination: true
  sniff:
    HTTP:
      ports: [80, 8080, 8880, 2052, 2082, 2086, 2095]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"        # è·³è¿‡å°ç±³äº‘æœåŠ¡ï¼Œé¿å…è¯¯åˆ¤
    - "+.apple.com"        # è·³è¿‡è‹¹æœåŸŸåï¼Œé˜²æ­¢å¹²æ‰° iCloud ç­‰æœåŠ¡
```

å—…æ¢å™¨ä¼šåˆ†ææµé‡çš„åº”ç”¨å±‚ç‰¹å¾æ¥è¯†åˆ«çœŸå®åŸŸåï¼Œå¯¹äº TUN é€æ˜ä»£ç†æ¨¡å¼å°¤ä¸ºå…³é”®ã€‚æ–°æ‰‹é˜¶æ®µå¦‚æœåªç”¨æ™®é€šçš„ HTTP/SOCKS5 ç«¯å£ä»£ç†ï¼Œå¯ä»¥å…ˆä¸å¼€å¯ï¼Œç­‰åˆ°ç”¨ TUN æ¨¡å¼æ—¶å†é…ç½®ã€‚

---

## 1.5 å‡ºç«™ä»£ç†èŠ‚ç‚¹ï¼ˆproxiesï¼‰

è¿™é‡Œå®šä¹‰ä½ çš„ä»£ç†èŠ‚ç‚¹ã€‚å¦‚æœä½ æœ‰æœºåœºè®¢é˜…ï¼Œå¯ä»¥å…ˆè·³åˆ° 1.6 èŠ‚ç”¨ `proxy-providers` å¼•å…¥ï¼›å¦‚æœä½ æœ‰è‡ªå»ºèŠ‚ç‚¹ï¼Œåœ¨è¿™é‡Œæ‰‹åŠ¨å¡«å†™ã€‚

```yaml
proxies:
  # â”€â”€ Shadowsocks èŠ‚ç‚¹ç¤ºä¾‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "SS-èŠ‚ç‚¹1"           # èŠ‚ç‚¹åç§°ï¼Œè‡ªå·±èµ·ä¸ªå¥½è®°çš„åå­—
    type: ss                   # åè®®ç±»å‹
    server: your.server.com    # æœåŠ¡å™¨åœ°å€ï¼ˆåŸŸåæˆ– IPï¼‰
    port: 12345                # ç«¯å£
    cipher: aes-128-gcm        # åŠ å¯†æ–¹å¼
    password: "your_password"  # å¯†ç 
    udp: true                  # æ˜¯å¦å¼€å¯ UDP æ”¯æŒ

  # â”€â”€ VMess èŠ‚ç‚¹ç¤ºä¾‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "VMess-èŠ‚ç‚¹1"
    type: vmess
    server: your.server.com
    port: 443
    uuid: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    alterId: 0                 # å»ºè®®ä½¿ç”¨ 0ï¼ˆAEAD æ¨¡å¼ï¼‰
    cipher: auto
    tls: true
    network: ws                # ä¼ è¾“åè®®ï¼šws / grpc / h2 ç­‰
    ws-opts:
      path: "/your-path"
      headers:
        Host: your.server.com

  # â”€â”€ Trojan èŠ‚ç‚¹ç¤ºä¾‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "Trojan-èŠ‚ç‚¹1"
    type: trojan
    server: your.server.com
    port: 443
    password: "your_password"
    sni: your.server.com       # SNIï¼ˆæœåŠ¡å™¨åç§°æŒ‡ç¤ºï¼‰
    udp: true

  # â”€â”€ VLESS+Reality èŠ‚ç‚¹ç¤ºä¾‹ï¼ˆå½“å‰æœ€æµè¡Œçš„æŠ—å°é”æ–¹æ¡ˆï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "VLESS-Reality"
    type: vless
    server: your.server.com
    port: 443
    uuid: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    network: tcp
    tls: true
    udp: true
    flow: xtls-rprx-vision     # Reality å¿…é¡»å¼€å¯è¿™ä¸ª
    servername: www.apple.com  # ä¼ªè£…åŸŸåï¼ˆéœ€è¦ä¸æœåŠ¡ç«¯ä¸€è‡´ï¼‰
    reality-opts:
      public-key: "your_public_key"
      short-id: "your_short_id"
    client-fingerprint: chrome # TLS æŒ‡çº¹ä¼ªè£…

  # â”€â”€ Hysteria2 èŠ‚ç‚¹ç¤ºä¾‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "HY2-èŠ‚ç‚¹1"
    type: hysteria2
    server: your.server.com
    port: 443
    password: "your_password"
    sni: your.server.com
    skip-cert-verify: false    # ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…ä¸º falseï¼ˆéªŒè¯è¯ä¹¦ï¼‰
```

**å°ç™½è¦ç‚¹ï¼š** èŠ‚ç‚¹ä¿¡æ¯é€šå¸¸ç”±æœºåœºæˆ–æœåŠ¡å•†æä¾›ï¼Œä¸éœ€è¦è‡ªå·±è®¡ç®—ï¼Œç›´æ¥å¤åˆ¶å¡«å†™å³å¯ã€‚æ¯ç§åè®®æ”¯æŒçš„å‚æ•°ç•¥æœ‰ä¸åŒï¼Œè¯¦è§ [å®˜æ–¹æ–‡æ¡£](https://wiki.metacubex.one/config/proxies/)ã€‚

---

## 1.6 ä»£ç†æä¾›è€…ï¼ˆproxy-providersï¼‰â€”â€” æœºåœºè®¢é˜…

å¦‚æœä½ ä½¿ç”¨æœºåœºï¼ˆè®¢é˜…æœåŠ¡ï¼‰ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¡«å†™æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”¨ `proxy-providers` è‡ªåŠ¨æ‹‰å–èŠ‚ç‚¹åˆ—è¡¨ï¼š

```yaml
proxy-providers:
  # è®¢é˜…æä¾›è€…çš„åç§°ï¼ˆè‡ªå®šä¹‰ï¼Œåç»­ä»£ç†ç»„ä¸­å¼•ç”¨ï¼‰
  æœºåœºA:
    type: http              # ä» URL æ‹‰å–èŠ‚ç‚¹
    url: "https://your-airport.com/api/v1/client/subscribe?token=xxxxx"
    interval: 86400         # è‡ªåŠ¨æ›´æ–°é—´éš”ï¼ˆç§’ï¼‰ï¼Œ86400 = 24 å°æ—¶
    health-check:           # èŠ‚ç‚¹å¥åº·æ£€æŸ¥ï¼ˆæµ‹é€Ÿï¼‰
      enable: true
      url: "https://www.gstatic.com/generate_204"  # æµ‹é€Ÿ URL
      interval: 300         # æ¯ 300 ç§’æµ‹ä¸€æ¬¡é€Ÿ
      timeout: 5000         # è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
      lazy: true            # æ‡’åŠ è½½ï¼šåªåœ¨æœ‰æµé‡æ—¶æ‰æµ‹é€Ÿï¼ŒèŠ‚çœèµ„æº
    # proxy: "DIRECT"       # æ‹‰å–è®¢é˜…æ—¶ä½¿ç”¨ä»€ä¹ˆä»£ç†ï¼ˆDIRECT=ç›´è¿ï¼‰
    override:               # è¦†ç›–èŠ‚ç‚¹çš„æŸäº›å‚æ•°ï¼ˆå¯é€‰ï¼‰
      skip-cert-verify: false
      udp: true

  # æœ¬åœ°æ–‡ä»¶æä¾›è€…ç¤ºä¾‹
  æœ¬åœ°èŠ‚ç‚¹:
    type: file
    path: "./proxies/local.yaml"   # ç›¸å¯¹äºé…ç½®æ–‡ä»¶ç›®å½•çš„è·¯å¾„
    health-check:
      enable: true
      url: "https://www.gstatic.com/generate_204"
      interval: 300
```

---

## 1.7 ä»£ç†ç»„ï¼ˆproxy-groupsï¼‰â€”â€” ç­–ç•¥æ ¸å¿ƒ

ä»£ç†ç»„å†³å®š"ä»€ä¹ˆæµé‡ç”¨ä»€ä¹ˆèŠ‚ç‚¹"ï¼Œæ˜¯é…ç½®æ–‡ä»¶çš„çµé­‚æ‰€åœ¨ã€‚

```yaml
proxy-groups:
  # â”€â”€ æ‰‹åŠ¨é€‰æ‹©ç»„ï¼šä½ åœ¨ Web UI ä¸­ç‚¹é€‰å“ªä¸ªèŠ‚ç‚¹å°±ç”¨å“ªä¸ª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
    type: select
    proxies:
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"       # å¯ä»¥åµŒå¥—å…¶ä»–ä»£ç†ç»„
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
      - DIRECT             # å†…ç½®ç­–ç•¥ï¼šç›´è¿
    # å¦‚æœä½¿ç”¨äº† proxy-providersï¼Œå¯ä»¥ç”¨ use å¼•å…¥
    use:
      - æœºåœºA

  # â”€â”€ è‡ªåŠ¨é€‰æ‹©ï¼ˆå»¶è¿Ÿæœ€ä½çš„èŠ‚ç‚¹ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
    type: url-test          # è‡ªåŠ¨æµ‹é€Ÿï¼Œé€‰å»¶è¿Ÿæœ€ä½çš„èŠ‚ç‚¹
    url: "https://www.gstatic.com/generate_204"
    interval: 300           # æ¯ 300 ç§’é‡æ–°æµ‹é€Ÿ
    tolerance: 50           # å»¶è¿Ÿå·®åœ¨ 50ms ä»¥å†…ä¸åˆ‡æ¢ï¼Œé¿å…é¢‘ç¹æŠ–åŠ¨
    use:
      - æœºåœºA

  # â”€â”€ æŒ‰åœ°åŒºåˆ†ç±»ï¼ˆæ‰‹åŠ¨é€‰æ‹©ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)æ¸¯|HK|Hong Kong"   # ç”¨æ­£åˆ™è¡¨è¾¾å¼ç­›é€‰èŠ‚ç‚¹åç§°
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºA

  - name: "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)æ–°åŠ å¡|SG|Singapore"
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºA

  - name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)æ—¥æœ¬|JP|Japan"
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºA

  - name: "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)ç¾|US|United States"
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºA

  # â”€â”€ åŠŸèƒ½æ€§åˆ†ç»„ï¼šç‰¹å®šæµé‡ä¸“å±èŠ‚ç‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "ğŸ“¹ æµåª’ä½“"
    type: select
    proxies:
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
      - "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹"
      - "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"

  - name: "ğŸ¤– AI æœåŠ¡"    # OpenAI / Claude ç­‰é™åˆ¶åœ°åŒºçš„æœåŠ¡
    type: select
    proxies:
      - "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"

  # â”€â”€ å…œåº•åˆ†ç»„ï¼šæ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•è§„åˆ™æ—¶ä½¿ç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "ğŸŸ æ¼ç½‘ä¹‹é±¼"
    type: select
    proxies:
      - DIRECT
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
```

**å››ç§ä»£ç†ç»„ç±»å‹ç®€ä»‹ï¼š**

- `select`ï¼šæ‰‹åŠ¨é€‰æ‹©ï¼Œä½ åœ¨é¢æ¿é‡Œç‚¹å“ªä¸ªå°±ç”¨å“ªä¸ªï¼Œæœ€çµæ´»ã€‚
- `url-test`ï¼šè‡ªåŠ¨æµ‹é€Ÿï¼Œé€‰å»¶è¿Ÿæœ€ä½çš„èŠ‚ç‚¹ï¼Œé€‚åˆ"è‡ªåŠ¨é€‰æ‹©"åœºæ™¯ã€‚
- `fallback`ï¼šæ•…éšœè½¬ç§»ï¼Œå½“å‰èŠ‚ç‚¹ä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œé€‚åˆé«˜å¯ç”¨åœºæ™¯ã€‚
- `load-balance`ï¼šè´Ÿè½½å‡è¡¡ï¼Œåœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´åˆ†æ•£æµé‡ï¼Œé€‚åˆæœ‰å¤šæ¡çº¿è·¯æ—¶æå‡å¸¦å®½ã€‚

---

## 1.8 è·¯ç”±è§„åˆ™ï¼ˆrulesï¼‰â€”â€” å†³å®šæµé‡èµ°å‘

è§„åˆ™ä»ä¸Šå¾€ä¸‹é€æ¡åŒ¹é…ï¼Œ**ç¬¬ä¸€æ¡åŒ¹é…åˆ°çš„è§„åˆ™ç”Ÿæ•ˆ**ï¼Œåé¢çš„è§„åˆ™ä¸å†æ£€æŸ¥ã€‚

```yaml
rules:
  # â”€â”€ ç‰¹æ®ŠåŸŸå / IP ç›´è¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - DOMAIN,localhost,DIRECT
  - DOMAIN-SUFFIX,local,DIRECT

  # â”€â”€ ç§æœ‰ IP åœ°å€ç›´è¿ï¼ˆå±€åŸŸç½‘è®¾å¤‡è®¿é—®ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - IP-CIDR,127.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
  - IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
  - IP-CIDR6,::1/128,DIRECT,no-resolve

  # â”€â”€ å›½å†…å¸¸ç”¨æœåŠ¡ç›´è¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - DOMAIN-SUFFIX,cn,DIRECT                  # æ‰€æœ‰ .cn åŸŸåç›´è¿
  - DOMAIN-KEYWORD,baidu,DIRECT
  - DOMAIN-KEYWORD,taobao,DIRECT
  - DOMAIN-KEYWORD,tmall,DIRECT
  - DOMAIN-KEYWORD,aliyun,DIRECT
  - DOMAIN-KEYWORD,tencent,DIRECT
  - DOMAIN-KEYWORD,weixin,DIRECT
  - DOMAIN-KEYWORD,bilibili,DIRECT
  - DOMAIN-SUFFIX,qq.com,DIRECT
  - GEOSITE,CN,DIRECT                        # ä½¿ç”¨ GeoSite æ•°æ®åº“è¯†åˆ«å›½å†…åŸŸå

  # â”€â”€ å›½å†… IP ç›´è¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - GEOIP,CN,DIRECT

  # â”€â”€ å…¶ä»–æµé‡èµ°ä»£ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼                        # MATCH æ˜¯æœ€ç»ˆå…œåº•è§„åˆ™ï¼Œå¿…é¡»æœ‰
```

**è§„åˆ™ç±»å‹è§£é‡Šï¼š**

- `DOMAIN`ï¼šå®Œå…¨åŒ¹é…åŸŸåï¼ˆ`DOMAIN,google.com` åªåŒ¹é… `google.com`ï¼Œä¸åŒ¹é… `www.google.com`ï¼‰
- `DOMAIN-SUFFIX`ï¼šåŒ¹é…åŸŸååç¼€ï¼ˆ`DOMAIN-SUFFIX,google.com` åŒ¹é… `www.google.com`ã€`mail.google.com` ç­‰ï¼‰
- `DOMAIN-KEYWORD`ï¼šåŒ…å«å…³é”®è¯ï¼ˆ`DOMAIN-KEYWORD,google` åŒ¹é…ä»»ä½•å« `google` çš„åŸŸåï¼‰
- `IP-CIDR`ï¼šåŒ¹é… IP æ®µï¼ˆ`no-resolve` è¡¨ç¤ºä¸å¯¹åŸŸåè¿›è¡Œ DNS è§£æåå†åŒ¹é…ï¼Œç›´æ¥æŒ‰åŸŸåè§„åˆ™èµ°ï¼‰
- `GEOSITE`ï¼šä½¿ç”¨ GeoSite æ•°æ®åº“ï¼ˆ`CN` = ä¸­å›½å¤§é™†åŸŸåé›†åˆï¼‰
- `GEOIP`ï¼šä½¿ç”¨ GeoIP æ•°æ®åº“ï¼ˆ`CN` = ä¸­å›½å¤§é™† IP é›†åˆï¼‰
- `PROCESS-NAME`ï¼šæŒ‰è¿›ç¨‹ååŒ¹é…ï¼ˆä»…æ¡Œé¢ç«¯æ”¯æŒï¼‰
- `MATCH`ï¼šå…œåº•è§„åˆ™ï¼Œå¿…é¡»æ˜¯æœ€åä¸€æ¡

---

## 1.9 æœ€å°å¯ç”¨å®Œæ•´ç¤ºä¾‹

æŠŠä¸Šé¢çš„å†…å®¹æ‹¼åœ¨ä¸€èµ·ï¼Œå°±æ˜¯ä¸€ä»½èƒ½è·‘èµ·æ¥çš„æœ€åŸºç¡€é…ç½®ï¼š

```yaml
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Mihomo æœ€å°å¯ç”¨é…ç½® - æ–°æ‰‹èµ·æ­¥ç‰ˆ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

mixed-port: 7890
allow-lan: false
mode: rule
log-level: info
ipv6: false
find-process-mode: strict

external-controller: 127.0.0.1:9090

profile:
  store-selected: true
  store-fake-ip: true

# â”€â”€ DNS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*.lan"
    - "*.local"
  nameserver:
    - 223.5.5.5
    - 119.29.29.29
  fallback:
    - tls://8.8.8.8:853
    - tls://1.1.1.1:853
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4

# â”€â”€ ä»£ç†èŠ‚ç‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
proxies:
  - name: "æˆ‘çš„èŠ‚ç‚¹"
    type: ss
    server: your.server.com
    port: 12345
    cipher: aes-128-gcm
    password: "your_password"
    udp: true

# â”€â”€ ä»£ç†ç»„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
proxy-groups:
  - name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
    type: select
    proxies:
      - "æˆ‘çš„èŠ‚ç‚¹"
      - DIRECT

  - name: "ğŸŸ æ¼ç½‘ä¹‹é±¼"
    type: select
    proxies:
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
      - DIRECT

# â”€â”€ è·¯ç”±è§„åˆ™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
rules:
  - GEOSITE,CN,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
```

**éªŒè¯é…ç½®ï¼š** å¯åŠ¨ mihomo åï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—® `http://127.0.0.1:9090/ui`ï¼ˆå¦‚æœé…ç½®äº† external-uiï¼‰æˆ–ä½¿ç”¨ä»»æ„ Web é¢æ¿è¿æ¥ `127.0.0.1:9090`ï¼Œèƒ½çœ‹åˆ°èŠ‚ç‚¹è¯´æ˜é…ç½®åŸºæœ¬æ­£ç¡®ã€‚

---

# ç¬¬äºŒé˜¶æ®µï¼šæ–°æ‰‹ç¯‡ â€”â€” åˆ†æµç²¾å‡†ï¼Œç®¡ç†æ–¹ä¾¿

è¿™ä¸€é˜¶æ®µçš„ç›®æ ‡æ˜¯è®©é…ç½®æ›´åŠ å®Œå–„ï¼š**å¼•å…¥è§„åˆ™é›†å®ç°ç²¾å‡†åˆ†æµã€åˆç†ç»„ç»‡ä»£ç†ç»„ã€ä¼˜åŒ– DNSã€å¼€å¯æµé‡å—…æ¢**ï¼Œå‘Šåˆ«æ‰‹å†™æ¯ä¸€æ¡è§„åˆ™çš„ä½æ•ˆæ–¹å¼ã€‚

---

## 2.1 ç”¨è§„åˆ™æä¾›è€…ï¼ˆrule-providersï¼‰ä»£æ›¿æ‰‹å†™è§„åˆ™

æ‰‹å†™æ¯ä¸€æ¡è§„åˆ™è´¹æ—¶è´¹åŠ›ï¼Œä¸”éš¾ä»¥ç»´æŠ¤ã€‚`rule-providers` å…è®¸ä½ è®¢é˜…ç¤¾åŒºç»´æŠ¤çš„è§„åˆ™é›†ï¼Œè‡ªåŠ¨æ›´æ–°ï¼Œè¦†ç›–å…¨é¢ã€‚

```yaml
rule-providers:
  # â”€â”€ ç›´è¿è§„åˆ™é›† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  direct-domain:
    type: http
    behavior: domain          # domain / ipcidr / classical ä¸‰ç§æ ¼å¼
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/cn.mrs"
    path: "./rule-providers/direct-domain.mrs"
    interval: 86400           # 24 å°æ—¶æ›´æ–°ä¸€æ¬¡
    format: mrs               # mihomo ä¸“ç”¨çš„é«˜æ•ˆäºŒè¿›åˆ¶æ ¼å¼

  direct-ip:
    type: http
    behavior: ipcidr
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geoip/cn.mrs"
    path: "./rule-providers/direct-ip.mrs"
    interval: 86400
    format: mrs

  # â”€â”€ ä»£ç†è§„åˆ™é›† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  proxy-domain:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/geolocation-!cn.mrs"
    path: "./rule-providers/proxy-domain.mrs"
    interval: 86400
    format: mrs

  # â”€â”€ å¹¿å‘Šè¿‡æ»¤è§„åˆ™é›† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ad-filter:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-clash.yaml"
    path: "./rule-providers/ad-filter.yaml"
    interval: 86400
    format: yaml

  # â”€â”€ æµåª’ä½“è§„åˆ™é›† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  netflix:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/netflix.mrs"
    path: "./rule-providers/netflix.mrs"
    interval: 86400
    format: mrs

  youtube:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/youtube.mrs"
    path: "./rule-providers/youtube.mrs"
    interval: 86400
    format: mrs

  # â”€â”€ AI æœåŠ¡è§„åˆ™é›† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  openai:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/openai.mrs"
    path: "./rule-providers/openai.mrs"
    interval: 86400
    format: mrs

  # â”€â”€ ç”µæŠ¥è§„åˆ™é›† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  telegram:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/telegram.mrs"
    path: "./rule-providers/telegram.mrs"
    interval: 86400
    format: mrs

  telegram-ip:
    type: http
    behavior: ipcidr
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geoip/telegram.mrs"
    path: "./rule-providers/telegram-ip.mrs"
    interval: 86400
    format: mrs
```

**behavior ä¸‰ç§æ ¼å¼è¯´æ˜ï¼š**
- `domain`ï¼šæ¯è¡Œä¸€ä¸ªåŸŸåæˆ–åŸŸååç¼€ï¼Œä½“ç§¯å°ï¼Œæ€§èƒ½æœ€å¥½ã€‚
- `ipcidr`ï¼šæ¯è¡Œä¸€ä¸ª IP æ®µï¼Œç”¨äº IP åŒ¹é…è§„åˆ™ã€‚
- `classical`ï¼šç»å…¸æ ¼å¼ï¼Œæ¯è¡Œæ˜¯å®Œæ•´çš„è§„åˆ™è¯­æ³•ï¼ˆå¦‚ `DOMAIN,google.com`ï¼‰ï¼Œæœ€çµæ´»ä½†ä½“ç§¯æœ€å¤§ã€‚

**format è¯´æ˜ï¼š**
- `mrs`ï¼šmihomo ä¸“ç”¨çš„äºŒè¿›åˆ¶æ ¼å¼ï¼ŒåŠ è½½é€Ÿåº¦å¿«ï¼Œå†…å­˜å ç”¨ä½ï¼Œæ¨èä½¿ç”¨ã€‚
- `yaml`ï¼šæ–‡æœ¬ YAML æ ¼å¼ï¼Œå…¼å®¹æ€§å¥½ï¼Œé€‚ç”¨äºå„ç±»ç¤¾åŒºè§„åˆ™é›†ã€‚

---

## 2.2 ç»“åˆè§„åˆ™é›†çš„å®Œæ•´ä»£ç†ç»„è®¾è®¡

```yaml
proxy-groups:
  # â”€â”€ é¡¶å±‚å…¥å£ï¼šæ‰‹åŠ¨é€‰æ‹©ä¸»è¦ç­–ç•¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
    type: select
    proxies:
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
      - "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹"
      - "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
      - DIRECT
    use:
      - æœºåœºA

  # â”€â”€ è‡ªåŠ¨æµ‹é€Ÿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
    type: url-test
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50
    use:
      - æœºåœºA

  # â”€â”€ åœ°åŒºåˆ†ç»„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)æ¸¯|HK|Hong Kong|ğŸ‡­ğŸ‡°"
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºA

  - name: "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)æ–°åŠ å¡|SG|Singapore|ğŸ‡¸ğŸ‡¬"
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºA

  - name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)æ—¥æœ¬|JP|Japan|ğŸ‡¯ğŸ‡µ"
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºA

  - name: "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)ç¾|US|United States|ğŸ‡ºğŸ‡¸"
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºA

  # â”€â”€ åŠŸèƒ½æ€§åˆ†ç»„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "ğŸ“¹ æµåª’ä½“"
    type: select
    proxies:
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
      - "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹"
      - "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"

  - name: "ğŸ¤– AI æœåŠ¡"
    type: select
    proxies:
      - "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"

  - name: "ğŸ“± ç”µæŠ¥æ¶ˆæ¯"
    type: select
    proxies:
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"

  - name: "ğŸ›¡ï¸ å¹¿å‘Šè¿‡æ»¤"
    type: select
    proxies:
      - REJECT              # REJECT = æ‹¦æˆªï¼Œä¸å‘é€ä»»ä½•å“åº”
      - DIRECT
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"

  # â”€â”€ å…œåº• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - name: "ğŸŸ æ¼ç½‘ä¹‹é±¼"
    type: select
    proxies:
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
      - DIRECT
```

---

## 2.3 ç»“åˆè§„åˆ™é›†çš„ç²¾å‡†è·¯ç”±è§„åˆ™

```yaml
rules:
  # â”€â”€ å¹¿å‘Šæ‹¦æˆªï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼Œç›´æ¥ REJECTï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - RULE-SET,ad-filter,ğŸ›¡ï¸ å¹¿å‘Šè¿‡æ»¤

  # â”€â”€ AI æœåŠ¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - RULE-SET,openai,ğŸ¤– AI æœåŠ¡

  # â”€â”€ ç”µæŠ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - RULE-SET,telegram,ğŸ“± ç”µæŠ¥æ¶ˆæ¯
  - RULE-SET,telegram-ip,ğŸ“± ç”µæŠ¥æ¶ˆæ¯,no-resolve

  # â”€â”€ æµåª’ä½“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - RULE-SET,netflix,ğŸ“¹ æµåª’ä½“
  - RULE-SET,youtube,ğŸ“¹ æµåª’ä½“

  # â”€â”€ å›½å†…å†…å®¹ç›´è¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - RULE-SET,direct-domain,DIRECT
  - RULE-SET,direct-ip,DIRECT,no-resolve

  # â”€â”€ å›½å¤–å†…å®¹èµ°ä»£ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - RULE-SET,proxy-domain,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  # â”€â”€ GeoIP/GeoSite å…œåº• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - GEOSITE,CN,DIRECT
  - GEOIP,CN,DIRECT

  # â”€â”€ ç§æœ‰åœ°å€ç›´è¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
  - IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
  - IP-CIDR,127.0.0.0/8,DIRECT,no-resolve

  # â”€â”€ æœ€ç»ˆå…œåº• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
```

---

## 2.4 æ›´å®Œå–„çš„ DNS é…ç½®

```yaml
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16

  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "*.localhost"
    - localhost.ptlogin2.qq.com
    # STUN åè®®ï¼ˆæ¸¸æˆã€WebRTC éœ€è¦ï¼‰
    - "+.stun.*.*"
    - "+.stun.*.*.*"
    - "+.stun.*.*.*.*"
    # å¾®è½¯ NTP
    - "time.windows.com"
    - "time.nist.gov"
    # iOS æ¨é€
    - "+.apple.com"
    # ä»»å¤©å ‚è”æœº
    - "+.nintendo.net"
    # Xbox
    - "+.xboxlive.com"

  # é»˜è®¤ä½¿ç”¨è¿™äº› DNS è§£æå›½å†…åŸŸå
  nameserver:
    - 223.5.5.5            # é˜¿é‡Œ DoTï¼ˆæ˜æ–‡ï¼Œé€Ÿåº¦å¿«ï¼‰
    - 119.29.29.29         # è…¾è®¯ DNS
    - "https://doh.pub/dns-query"  # è…¾è®¯ DoHï¼ˆåŠ å¯†ï¼‰
    - "https://dns.alidns.com/dns-query"  # é˜¿é‡Œ DoH

  # å›½å¤–åŸŸåçš„ DNSï¼ˆé€šè¿‡ä»£ç†è®¿é—®ï¼Œé¿å…æ±¡æŸ“ï¼‰
  fallback:
    - "tls://8.8.8.8:853"
    - "tls://1.1.1.1:853"
    - "https://dns.google/dns-query"
    - "https://cloudflare-dns.com/dns-query"

  fallback-filter:
    geoip: true
    geoip-code: CN
    geosite:
      - gfw               # GFW å±è”½çš„åŸŸåå¼ºåˆ¶èµ° fallback
    ipcidr:
      - 240.0.0.0/4       # ä¿ç•™åœ°å€ï¼Œé€šå¸¸æ˜¯è¢«æ±¡æŸ“çš„æ ‡å¿—
    domain:               # æ‰‹åŠ¨æŒ‡å®šä¸€äº›åŸŸåèµ° fallback
      - "+.google.com"
      - "+.facebook.com"
      - "+.twitter.com"
      - "+.youtube.com"

  # æŒ‡å®šç‰¹å®šåŸŸåä½¿ç”¨ç‰¹å®š DNS è§£æï¼ˆç²¾ç»†æ§åˆ¶ï¼‰
  nameserver-policy:
    "geosite:cn":          # å›½å†…åŸŸååªèµ°å›½å†… DNS
      - 223.5.5.5
      - 119.29.29.29
    "geosite:geolocation-!cn":  # å›½å¤–åŸŸåèµ°å›½å¤– DNS
      - "tls://8.8.8.8:853"
      - "tls://1.1.1.1:853"
    "+.internal.corp.com": # å…¬å¸å†…ç½‘åŸŸåèµ°å†…ç½‘ DNS
      - 10.0.0.53
```

---

## 2.5 å¤šè®¢é˜…ç®¡ç†ä¸èŠ‚ç‚¹è¿‡æ»¤æŠ€å·§

å¦‚æœä½ ç”¨äº†å¤šä¸ªæœºåœºï¼Œå¯ä»¥è¿™æ ·ç»„ç»‡ï¼š

```yaml
proxy-providers:
  æœºåœºA-Premium:
    type: http
    url: "https://airport-a.com/subscribe?token=xxx"
    interval: 86400
    health-check:
      enable: true
      url: "https://www.gstatic.com/generate_204"
      interval: 300
      lazy: true
    # è¿‡æ»¤æ‰è¯•ç”¨/æµé‡æé†’èŠ‚ç‚¹ï¼ˆè¿™äº›èŠ‚ç‚¹åé€šå¸¸å«ç‰¹æ®Šå…³é”®è¯ï¼‰
    filter: "(?i)^(?!.*(?:å‰©ä½™|åˆ°æœŸ|å®˜ç½‘|å…è´¹|è¯•ç”¨|å¥—é¤|é‡ç½®)).+"

  æœºåœºB-Standard:
    type: http
    url: "https://airport-b.com/subscribe?token=xxx"
    interval: 86400
    health-check:
      enable: true
      url: "https://www.gstatic.com/generate_204"
      interval: 300
      lazy: true

proxy-groups:
  # åˆå¹¶å¤šä¸ªæœºåœºçš„èŠ‚ç‚¹
  - name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
    type: select
    use:
      - æœºåœºA-Premium
      - æœºåœºB-Standard
    proxies:
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©-A"
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©-B"
      - DIRECT

  # åˆ†åˆ«ä¸ºæ¯ä¸ªæœºåœºå»ºç«‹è‡ªåŠ¨é€‰æ‹©ç»„ï¼Œä¾¿äºå¯¹æ¯”
  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©-A"
    type: url-test
    use:
      - æœºåœºA-Premium
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50

  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©-B"
    type: url-test
    use:
      - æœºåœºB-Standard
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50
```

---

# ç¬¬ä¸‰é˜¶æ®µï¼šè¿›é˜¶ç¯‡ â€”â€” æ€§èƒ½ã€å®‰å…¨ã€æè‡´ä½“éªŒ

è¿™ä¸€é˜¶æ®µé¢å‘æœ‰ä¸€å®šåŸºç¡€ã€è¿½æ±‚æ›´é«˜æ€§èƒ½å’Œå®šåˆ¶åŒ–ä½“éªŒçš„ç”¨æˆ·ã€‚æ¶µç›– **TUN é€æ˜ä»£ç†ã€è´Ÿè½½å‡è¡¡ã€é“¾å¼ä»£ç†ã€å­è§„åˆ™ã€æ€§èƒ½è°ƒä¼˜**ç­‰è¯é¢˜ã€‚

---

## 3.1 TUN æ¨¡å¼ï¼šæ¥ç®¡æ‰€æœ‰æµé‡

TUN æ¨¡å¼é€šè¿‡åˆ›å»ºè™šæ‹Ÿç½‘å¡åœ¨ç³»ç»Ÿå±‚é¢æ¥ç®¡æ‰€æœ‰æµé‡ï¼Œä¸éœ€è¦åº”ç”¨ç¨‹åºæ”¯æŒä»£ç†åè®®ï¼ˆä¸åƒ HTTP/SOCKS5 éœ€è¦åº”ç”¨ä¸»åŠ¨è®¾ç½®ï¼‰ï¼Œæ˜¯ç›®å‰æœ€å½»åº•çš„ä»£ç†æ–¹å¼ã€‚

**ä½¿ç”¨åœºæ™¯ï¼š** æ¸¸æˆã€å‘½ä»¤è¡Œå·¥å…·ï¼ˆå¦‚ gitã€curlï¼‰ã€æŸäº›ä¸æ”¯æŒä»£ç†çš„åº”ç”¨ã€‚

**å‰ç½®æ¡ä»¶ï¼š** éœ€è¦ç®¡ç†å‘˜/root æƒé™è¿è¡Œ mihomoã€‚

```yaml
tun:
  enable: true
  stack: mixed              # åè®®æ ˆï¼šmixedï¼ˆæ¨èï¼‰/ system / gvisor
                            # mixed = TCP ç”¨ systemï¼ŒUDP ç”¨ gvisorï¼Œæ€§èƒ½ä¸å…¼å®¹æ€§å‡è¡¡
  dns-hijack:
    - "any:53"              # åŠ«æŒæ‰€æœ‰å‘å¾€ 53 ç«¯å£çš„ DNS è¯·æ±‚ï¼ˆTCP å’Œ UDPï¼‰
  auto-detect-interface: true   # è‡ªåŠ¨è¯†åˆ«å‡ºå£ç½‘å¡ï¼ˆæ¨èå¼€å¯ï¼‰
  auto-route: true          # è‡ªåŠ¨é…ç½®ç³»ç»Ÿè·¯ç”±è¡¨ï¼ˆæ¥ç®¡æ‰€æœ‰æµé‡çš„å…³é”®ï¼‰
  mtu: 9000                 # æœ€å¤§ä¼ è¾“å•å…ƒï¼Œå¯é€‚å½“æé«˜ä»¥å‡å°‘åˆ†ç‰‡
  # strict-route: true      # æ›´ä¸¥æ ¼çš„è·¯ç”±ï¼ˆé˜²æ­¢ DNS/æµé‡æ³„æ¼ï¼Œä½†ä¼šå½±å“æŸäº› VPN åœºæ™¯ï¼‰
  gso: true                 # é€šç”¨åˆ†æ®µå¸è½½ï¼ˆLinux ä¸“å±ï¼Œå¯æå‡ UDP æ€§èƒ½ï¼‰
  gso-max-size: 65536
  # auto-redirect: false    # è‡ªåŠ¨ iptables é‡å®šå‘ï¼ˆè·¯ç”±å™¨æ¨¡å¼ä¸‹ä½¿ç”¨ï¼‰

  # ä»¥ä¸‹åœ°å€æ®µä¸èµ° TUNï¼ˆç›´è¿ï¼‰
  route-exclude-address:
    - 192.168.0.0/16
    - 10.0.0.0/8
    - 172.16.0.0/12
```

**TUN çš„ä¸‰ç§åè®®æ ˆå¯¹æ¯”ï¼š**

| åè®®æ ˆ | é€Ÿåº¦ | å…¼å®¹æ€§ | å†…å­˜å ç”¨ | é€‚ç”¨åœºæ™¯ |
|--------|------|--------|----------|----------|
| `system` | æœ€å¿« | æœ€å¥½ | æœ€ä½ | æ—¥å¸¸ä½¿ç”¨ |
| `gvisor` | è¾ƒæ…¢ | ä¸­ç­‰ | è¾ƒé«˜ | éœ€è¦æ›´å¥½ UDP æ”¯æŒæ—¶ |
| `mixed` | å±…ä¸­ | æœ€å¥½ | å±…ä¸­ | **æ¨èï¼Œå‡è¡¡ä¹‹é€‰** |

**TUN æ¨¡å¼é…åˆ DNS çš„æ³¨æ„äº‹é¡¹ï¼š**

å¼€å¯ TUN åï¼ŒDNS åŠ«æŒä¼šè‡ªåŠ¨å·¥ä½œï¼Œä½†éœ€è¦ç¡®ä¿ `sniffer` å¼€å¯ï¼Œå¦åˆ™ TUN æ‹¿åˆ°çš„å…¨æ˜¯ IPï¼Œæ²¡æœ‰åŸŸåä¿¡æ¯ï¼Œè§„åˆ™åŒ¹é…ä¼šé€€åŒ–ä¸º IP åŒ¹é…ã€‚

```yaml
sniffer:
  enable: true
  override-destination: true   # ç”¨å—…æ¢åˆ°çš„åŸŸåè¦†ç›–ç›®æ ‡åœ°å€ï¼Œè®©åŸŸåè§„åˆ™ç”Ÿæ•ˆ
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080, 8880, 2052, 2082, 2086, 2095]
      override-destination: true
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.apple.com"
    - "+.icloud.com"
```

---

## 3.2 è´Ÿè½½å‡è¡¡ï¼ˆload-balanceï¼‰

å½“ä½ æœ‰å¤šæ¡è´¨é‡ç›¸è¿‘çš„çº¿è·¯æ—¶ï¼Œè´Ÿè½½å‡è¡¡å¯ä»¥å……åˆ†åˆ©ç”¨å¸¦å®½èµ„æºï¼š

```yaml
proxy-groups:
  # æ•£åˆ—æ¨¡å¼ï¼šåŒä¸€ç›®æ ‡å§‹ç»ˆèµ°åŒä¸€èŠ‚ç‚¹ï¼ˆé€‚åˆæµåª’ä½“ï¼Œé¿å… IP è·³å˜å¯¼è‡´ç™»å½•çŠ¶æ€å¤±æ•ˆï¼‰
  - name: "âš–ï¸ è´Ÿè½½å‡è¡¡-æ•£åˆ—"
    type: load-balance
    strategy: consistent-hashing  # ä¸€è‡´æ€§æ•£åˆ—
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºA

  # è½®è¯¢æ¨¡å¼ï¼šæµé‡å‡åŒ€åˆ†é…åˆ°å„èŠ‚ç‚¹ï¼ˆé€‚åˆä¸‹è½½ã€ä¸€èˆ¬æµè§ˆï¼‰
  - name: "âš–ï¸ è´Ÿè½½å‡è¡¡-è½®è¯¢"
    type: load-balance
    strategy: round-robin        # è½®è¯¢
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºA

  # ç²˜æ€§ä¼šè¯ï¼šåŒä¸€è¿›ç¨‹çš„æµé‡å§‹ç»ˆèµ°åŒä¸€èŠ‚ç‚¹
  - name: "âš–ï¸ è´Ÿè½½å‡è¡¡-ç²˜æ€§"
    type: load-balance
    strategy: sticky-sessions    # ç²˜æ€§ä¼šè¯
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºA
```

---

## 3.3 é“¾å¼ä»£ç†ï¼ˆrelayï¼‰

å°†å¤šä¸ªèŠ‚ç‚¹ä¸²è”ï¼Œæµé‡ä¾æ¬¡ç»è¿‡æ¯ä¸ªèŠ‚ç‚¹ï¼Œé€‚åˆéœ€è¦"è·³æ¿"çš„åœºæ™¯ï¼ˆä¾‹å¦‚å…ˆè¿ä¸€ä¸ªå›½å†…èŠ‚ç‚¹ï¼Œå†ä»é‚£é‡Œè¿æµ·å¤–èŠ‚ç‚¹ï¼‰ï¼š

```yaml
proxies:
  - name: "å›½å†…è½åœ°èŠ‚ç‚¹"
    type: ss
    server: domestic.server.com
    port: 12345
    cipher: aes-128-gcm
    password: "password1"

  - name: "é¦™æ¸¯å‡ºå£èŠ‚ç‚¹"
    type: trojan
    server: hk.server.com
    port: 443
    password: "password2"
    sni: hk.server.com

proxy-groups:
  # é“¾å¼ï¼šæµé‡å…ˆè¿‡å›½å†…èŠ‚ç‚¹ï¼Œå†è·³åˆ°é¦™æ¸¯èŠ‚ç‚¹å‡ºå»
  - name: "ğŸ”— å›½å†…ä¸­è½¬-é¦™æ¸¯"
    type: relay
    proxies:
      - "å›½å†…è½åœ°èŠ‚ç‚¹"    # ç¬¬ä¸€è·³
      - "é¦™æ¸¯å‡ºå£èŠ‚ç‚¹"    # ç¬¬äºŒè·³ï¼ˆä»é¦™æ¸¯å‡ºå£ï¼‰
```

**æ³¨æ„ï¼š** `relay` é“¾ä¸­çš„ä¸­é—´èŠ‚ç‚¹ï¼ˆé™¤æœ€åä¸€ä¸ªï¼‰å¿…é¡»æ”¯æŒè½¬å‘ï¼Œä¸èƒ½æ˜¯éœ€è¦åº”ç”¨å±‚é…åˆçš„èŠ‚ç‚¹ï¼ˆå¦‚ Shadowsocks èŠ‚ç‚¹ä¸èƒ½ä½œä¸ºè·³æ¿æŒ‡å‘å¦ä¸€ä¸ªåè®®ï¼Œä½†å¯ä»¥ä¸²è”åŒç±»å‹çš„æˆ–ä½¿ç”¨ dialer-proxy æ–¹å¼ï¼‰ã€‚å®é™…ä½¿ç”¨ä¸­æ›´å¸¸è§çš„æ˜¯é…åˆ `dialer-proxy` å­—æ®µï¼Œè®©æŸä¸ªèŠ‚ç‚¹é€šè¿‡å¦ä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹è¿æ¥ã€‚

---

## 3.4 å­è§„åˆ™ï¼ˆsub-ruleï¼‰

å­è§„åˆ™å…è®¸ä½ åœ¨åŒ¹é…æŸä¸ªæ¡ä»¶åï¼Œè¿›å…¥ä¸€ä¸ªå­è§„åˆ™é›†ç»§ç»­åŒ¹é…ï¼Œå®ç°æ›´ç²¾ç»†çš„æµé‡æ§åˆ¶ï¼š

```yaml
sub-rules:
  # å½“æµé‡è¢«åˆ¤å®šä¸º"æµåª’ä½“"æ—¶ï¼Œè¿›å…¥è¿™ä¸ªå­è§„åˆ™è¿›ä¸€æ­¥ç»†åˆ†
  streaming:
    - GEOSITE,netflix,ğŸ¬ Netflix
    - GEOSITE,youtube,ğŸ“º YouTube
    - GEOSITE,bilibili,DIRECT       # Bç«™ç›´è¿
    - GEOSITE,disney,ğŸ¬ Disney+
    - MATCH,ğŸ“¹ æµåª’ä½“               # å…¶ä»–æµåª’ä½“èµ°é€šç”¨æµåª’ä½“ç»„

rules:
  # å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºæµåª’ä½“æµé‡ï¼Œæ˜¯çš„è¯è¿›å…¥å­è§„åˆ™ç»†åˆ†
  - RULE-SET,all-streaming,SUB-RULE,streaming
  # å…¶ä»–è§„åˆ™...
  - GEOSITE,CN,DIRECT
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
```

---

## 3.5 æ€§èƒ½è°ƒä¼˜

```yaml
# â”€â”€ å…¨å±€æ€§èƒ½ç›¸å…³é…ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# TCP å¹¶å‘ï¼šåŒæ—¶å¯¹ç›®æ ‡çš„æ‰€æœ‰è§£æ IP å‘èµ·è¿æ¥ï¼Œé€‰æœ€å¿«çš„
tcp-concurrent: true

# ç»Ÿä¸€å»¶è¿Ÿæµ‹è¯•ï¼šä½¿ç”¨å®é™…å¾€è¿”æ—¶é—´è€Œéæ¡æ‰‹æ—¶é—´ï¼Œæ›´å‡†ç¡®
unified-delay: true

# è¿æ¥ä¿æ´»ï¼ˆå‡å°‘é¢‘ç¹é‡å»ºè¿æ¥ï¼‰
keep-alive-interval: 30      # TCP keepalive é—´éš”ï¼ˆç§’ï¼‰
keep-alive-idle: 600         # TCP keepalive ç©ºé—²ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰

# GeoData åŠ è½½æ¨¡å¼
geodata-mode: true           # ä½¿ç”¨ GeoDataï¼ˆ.datï¼‰æ–‡ä»¶
geodata-loader: memconservative  # å†…å­˜èŠ‚çœæ¨¡å¼ï¼ˆè·¯ç”±å™¨æ¨èï¼‰
                             # å¤‡é€‰ï¼šstandardï¼ˆæ€§èƒ½æ›´é«˜ï¼Œå†…å­˜å ç”¨æ›´å¤šï¼‰

# Geosite åŒ¹é…å®ç°
geosite-matcher: succinct    # succinctï¼ˆç²¾ç®€ï¼‰/ mphï¼ˆå“ˆå¸Œï¼Œé€Ÿåº¦æœ€å¿«ï¼‰

# â”€â”€ å‡ºç«™ç½‘å¡ç»‘å®š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# å¤šç½‘å¡ç¯å¢ƒä¸‹æŒ‡å®šå‡ºå£ç½‘å¡ï¼ˆå¦‚æœ‰çº¿+æ— çº¿ï¼Œå¯å¼ºåˆ¶èµ°æœ‰çº¿å‡ºå£ï¼‰
# interface-name: eth0
# routing-mark: 666          # Linux è·¯ç”±æ ‡è®°ï¼Œé…åˆç­–ç•¥è·¯ç”±ä½¿ç”¨
```

---

## 3.6 è¿›é˜¶ DNSï¼šé˜²æ³„æ¼ä¸åˆ†ç¦»è§£æ

```yaml
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16

  # ä½¿ç”¨ä»£ç†è§£æ fallback DNSï¼Œå½»åº•é˜²æ­¢ DNS æ³„æ¼
  # ï¼ˆfallback DNS æœ¬èº«ä¹Ÿèµ°ä»£ç†éš§é“ï¼‰
  proxy-server-nameserver:
    - https://dns.google/dns-query   # ç”¨äºè§£æä»£ç†æœåŠ¡å™¨åŸŸåæœ¬èº«

  # æ‹’ç»è§£æå·²çŸ¥å¹¿å‘Š/è¿½è¸ªåŸŸåï¼ˆDNS å±‚é¢çš„å¹¿å‘Šè¿‡æ»¤ï¼‰
  nameserver-policy:
    "geosite:category-ads-all": rcode://success   # è¿”å› NXDOMAINï¼Œç­‰æ•ˆæ‹¦æˆª

    # å›½å†…åŸŸåèµ°å›½å†… DNS
    "geosite:cn,private":
      - 223.5.5.5
      - 119.29.29.29

    # å›½å¤–åŸŸåèµ°åŠ å¯† DNSï¼ˆé€šè¿‡ä»£ç†ï¼‰
    "geosite:geolocation-!cn":
      - "tls://8.8.8.8"
      - "tls://1.1.1.1"

  # é»˜è®¤ nameserverï¼ˆå¤„ç† nameserver-policy æœªè¦†ç›–çš„æƒ…å†µï¼‰
  nameserver:
    - 223.5.5.5
    - 119.29.29.29

  fallback:
    - "tls://8.8.8.8"
    - "tls://1.1.1.1"

  fallback-filter:
    geoip: true
    geoip-code: CN
    geosite:
      - gfw
    ipcidr:
      - 240.0.0.0/4
```

---

## 3.7 å®Œæ•´è¿›é˜¶é…ç½®æ¨¡æ¿

å°†æ‰€æœ‰è¿›é˜¶ç‰¹æ€§æ•´åˆçš„å®Œæ•´ç¤ºä¾‹ï¼š

```yaml
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Mihomo è¿›é˜¶é…ç½®æ¨¡æ¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â”€â”€ å…¨å±€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
mixed-port: 7890
allow-lan: false
mode: rule
log-level: warning          # ç”Ÿäº§ç¯å¢ƒç”¨ warningï¼ŒèŠ‚çœæ€§èƒ½
ipv6: false
find-process-mode: strict
tcp-concurrent: true
unified-delay: true
keep-alive-interval: 30
keep-alive-idle: 600
geodata-mode: true
geodata-loader: memconservative

external-controller: 127.0.0.1:9090
# secret: "your_strong_password"

profile:
  store-selected: true
  store-fake-ip: true

geox-url:
  geoip: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"

# â”€â”€ TUN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tun:
  enable: true
  stack: mixed
  dns-hijack:
    - "any:53"
  auto-detect-interface: true
  auto-route: true
  mtu: 9000

# â”€â”€ åŸŸåå—…æ¢ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
sniffer:
  enable: true
  override-destination: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080, 8880, 2052, 2082, 2086, 2095]
      override-destination: true
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.apple.com"
    - "+.icloud.com"

# â”€â”€ DNS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "*.localhost"
    - "time.windows.com"
    - "time.nist.gov"
    - "+.stun.*.*"
    - "+.stun.*.*.*"
  proxy-server-nameserver:
    - https://dns.google/dns-query
  nameserver-policy:
    "geosite:cn,private":
      - 223.5.5.5
      - 119.29.29.29
    "geosite:geolocation-!cn":
      - "tls://8.8.8.8"
      - "tls://1.1.1.1"
  nameserver:
    - 223.5.5.5
    - 119.29.29.29
  fallback:
    - "tls://8.8.8.8"
    - "tls://1.1.1.1"
  fallback-filter:
    geoip: true
    geoip-code: CN
    geosite:
      - gfw
    ipcidr:
      - 240.0.0.0/4

# â”€â”€ ä»£ç†èŠ‚ç‚¹ï¼ˆç¤ºä¾‹ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
proxies:
  - name: "ç¤ºä¾‹èŠ‚ç‚¹"
    type: vless
    server: your.server.com
    port: 443
    uuid: "your-uuid"
    network: tcp
    tls: true
    flow: xtls-rprx-vision
    servername: www.apple.com
    reality-opts:
      public-key: "your-public-key"
      short-id: "your-short-id"
    client-fingerprint: chrome
    udp: true

# â”€â”€ è®¢é˜…æä¾›è€… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
proxy-providers:
  æœºåœºè®¢é˜…:
    type: http
    url: "https://your-airport.com/subscribe?token=xxx"
    interval: 86400
    health-check:
      enable: true
      url: "https://www.gstatic.com/generate_204"
      interval: 300
      timeout: 5000
      lazy: true
    filter: "(?i)^(?!.*(?:å‰©ä½™|åˆ°æœŸ|å®˜ç½‘|å…è´¹|è¯•ç”¨|å¥—é¤)).+"

# â”€â”€ ä»£ç†ç»„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
proxy-groups:
  - name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
    type: select
    proxies:
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
      - "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹"
      - "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
      - DIRECT
    use:
      - æœºåœºè®¢é˜…

  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
    type: url-test
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50
    use:
      - æœºåœºè®¢é˜…

  - name: "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)æ¸¯|HK|Hong Kong|ğŸ‡­ğŸ‡°"
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºè®¢é˜…

  - name: "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)æ–°åŠ å¡|SG|Singapore|ğŸ‡¸ğŸ‡¬"
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºè®¢é˜…

  - name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)æ—¥æœ¬|JP|Japan|ğŸ‡¯ğŸ‡µ"
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºè®¢é˜…

  - name: "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
    type: url-test
    filter: "(?i)ç¾|US|United States|ğŸ‡ºğŸ‡¸"
    url: "https://www.gstatic.com/generate_204"
    interval: 300
    use:
      - æœºåœºè®¢é˜…

  - name: "ğŸ¤– AI æœåŠ¡"
    type: select
    proxies:
      - "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"

  - name: "ğŸ“¹ æµåª’ä½“"
    type: select
    proxies:
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
      - "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹"
      - "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹"
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"

  - name: "ğŸ“± ç”µæŠ¥æ¶ˆæ¯"
    type: select
    proxies:
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹"
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹"

  - name: "ğŸ›¡ï¸ å¹¿å‘Šè¿‡æ»¤"
    type: select
    proxies:
      - REJECT
      - DIRECT

  - name: "ğŸŸ æ¼ç½‘ä¹‹é±¼"
    type: select
    proxies:
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
      - DIRECT

# â”€â”€ è§„åˆ™é›† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
rule-providers:
  ad-filter:
    type: http
    behavior: domain
    url: "https://anti-ad.net/clash.yaml"
    path: "./rule-providers/ad-filter.yaml"
    interval: 86400
    format: yaml

  openai:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/openai.mrs"
    path: "./rule-providers/openai.mrs"
    interval: 86400
    format: mrs

  anthropic:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/anthropic.mrs"
    path: "./rule-providers/anthropic.mrs"
    interval: 86400
    format: mrs

  telegram-domain:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/telegram.mrs"
    path: "./rule-providers/telegram-domain.mrs"
    interval: 86400
    format: mrs

  telegram-ip:
    type: http
    behavior: ipcidr
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geoip/telegram.mrs"
    path: "./rule-providers/telegram-ip.mrs"
    interval: 86400
    format: mrs

  netflix:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/netflix.mrs"
    path: "./rule-providers/netflix.mrs"
    interval: 86400
    format: mrs

  youtube:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/youtube.mrs"
    path: "./rule-providers/youtube.mrs"
    interval: 86400
    format: mrs

  cn-domain:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/cn.mrs"
    path: "./rule-providers/cn-domain.mrs"
    interval: 86400
    format: mrs

  cn-ip:
    type: http
    behavior: ipcidr
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geoip/cn.mrs"
    path: "./rule-providers/cn-ip.mrs"
    interval: 86400
    format: mrs

  proxy-domain:
    type: http
    behavior: domain
    url: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geo/geosite/geolocation-!cn.mrs"
    path: "./rule-providers/proxy-domain.mrs"
    interval: 86400
    format: mrs

# â”€â”€ è·¯ç”±è§„åˆ™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
rules:
  # å¹¿å‘Šæ‹¦æˆªï¼ˆæœ€ä¼˜å…ˆï¼‰
  - RULE-SET,ad-filter,ğŸ›¡ï¸ å¹¿å‘Šè¿‡æ»¤

  # AI æœåŠ¡ï¼ˆéœ€è¦ç¾å›½/æ–°åŠ å¡èŠ‚ç‚¹ï¼‰
  - RULE-SET,openai,ğŸ¤– AI æœåŠ¡
  - RULE-SET,anthropic,ğŸ¤– AI æœåŠ¡

  # ç”µæŠ¥
  - RULE-SET,telegram-domain,ğŸ“± ç”µæŠ¥æ¶ˆæ¯
  - RULE-SET,telegram-ip,ğŸ“± ç”µæŠ¥æ¶ˆæ¯,no-resolve

  # æµåª’ä½“
  - RULE-SET,netflix,ğŸ“¹ æµåª’ä½“
  - RULE-SET,youtube,ğŸ“¹ æµåª’ä½“

  # å›½å†…å†…å®¹ç›´è¿
  - RULE-SET,cn-domain,DIRECT
  - RULE-SET,cn-ip,DIRECT,no-resolve

  # å›½å¤–å†…å®¹èµ°ä»£ç†
  - RULE-SET,proxy-domain,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  # GeoSite / GeoIP å…œåº•
  - GEOSITE,CN,DIRECT
  - GEOIP,CN,DIRECT

  # ç§æœ‰åœ°å€ç›´è¿
  - IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
  - IP-CIDR,127.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR6,::1/128,DIRECT,no-resolve

  # æœ€ç»ˆå…œåº•
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
```

---

## 3.8 å¸¸è§é—®é¢˜ä¸æ’æŸ¥

**Qï¼šé…ç½®å†™å¥½å mihomo å¯åŠ¨å¤±è´¥ï¼Œæ€ä¹ˆåŠï¼Ÿ**

é¦–å…ˆçœ‹æ—¥å¿—ï¼ˆ`log-level: debug` é‡å¯åæŸ¥çœ‹ï¼‰ï¼Œæˆ–åœ¨å‘½ä»¤è¡Œç›´æ¥è¿è¡Œ `mihomo -d /path/to/config/dir` æŸ¥çœ‹æŠ¥é”™è¾“å‡ºã€‚æœ€å¸¸è§çš„é”™è¯¯æ˜¯ YAML ç¼©è¿›é”™è¯¯ï¼ˆæ··ç”¨ Tab å’Œç©ºæ ¼ï¼‰ã€ç«¯å£è¢«å ç”¨ï¼ˆ`Address already in use`ï¼‰ã€èŠ‚ç‚¹ä¿¡æ¯æ ¼å¼é”™è¯¯ã€‚

**Qï¼šèŠ‚ç‚¹æ˜¾ç¤ºå»¶è¿Ÿä½†ç½‘é¡µæ‰“ä¸å¼€ï¼Ÿ**

å»¶è¿Ÿæµ‹è¯•åªæµ‹ ICMP æˆ– HTTP 204ï¼Œä¸ä»£è¡¨å®é™…å¯ç”¨æ€§ã€‚å¸¸è§åŸå› ï¼šèŠ‚ç‚¹æœ¬èº«ä¸ç¨³å®šã€DNS é…ç½®æœ‰é—®é¢˜å¯¼è‡´è§£æé”™è¯¯ã€è§„åˆ™é…ç½®é”™è¯¯ï¼ˆå›½å†…æµé‡èµ°äº†ä»£ç†ï¼Œæˆ–å›½å¤–æµé‡èµ°äº†ç›´è¿ï¼‰ã€‚å»ºè®®å…ˆç”¨ `mode: global` æ’é™¤è§„åˆ™é—®é¢˜ï¼Œç¡®è®¤èŠ‚ç‚¹å¯ç”¨åå†æ”¹å› `rule`ã€‚

**Qï¼šæ¸¸æˆå»¶è¿Ÿå˜é«˜æˆ–æ— æ³•è”æœºï¼Ÿ**

æ¸¸æˆé€šå¸¸ç”¨ UDPï¼Œéƒ¨åˆ†ä»£ç†èŠ‚ç‚¹ä¸æ”¯æŒ UDP è½¬å‘ï¼ˆ`udp: true` éœ€è¦èŠ‚ç‚¹æœåŠ¡ç«¯ä¹Ÿæ”¯æŒï¼‰ã€‚å¦å¤–ï¼Œå¼€å¯ TUN å STUN åè®®å¯èƒ½è¢« fake-ip å¹²æ‰°ï¼Œéœ€è¦æŠŠæ¸¸æˆæœåŠ¡å™¨åŸŸååŠ å…¥ `fake-ip-filter`ã€‚

**Qï¼šDNS æ³„æ¼æ€ä¹ˆæ£€æµ‹å’Œä¿®å¤ï¼Ÿ**

è®¿é—® `dnsleaktest.com` è¿›è¡Œæµ‹è¯•ã€‚å¦‚æœæ£€æµ‹åˆ°å›½å†… DNS æœåŠ¡å™¨ï¼ˆå¦‚ 114.114.114.114ï¼‰ï¼Œè¯´æ˜å­˜åœ¨æ³„æ¼ã€‚ä¿®å¤æ–¹æ³•ï¼šç¡®ä¿ `fallback` å’Œ `proxy-server-nameserver` é…ç½®æ­£ç¡®ï¼Œå›½å¤–åŸŸåçš„ DNS æŸ¥è¯¢éœ€è¦ç»è¿‡ä»£ç†ã€‚

**Qï¼š`no-resolve` æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ**

åœ¨ `IP-CIDR` å’Œ `GEOIP` è§„åˆ™åé¢åŠ  `no-resolve`ï¼Œè¡¨ç¤ºå¯¹åŸŸåç±»æµé‡ä¸åš DNS è§£æåå†åŒ¹é… IP è§„åˆ™ï¼Œè€Œæ˜¯ç›´æ¥è·³è¿‡ï¼ˆç­‰åˆ°æµé‡å®é™…åˆ°è¾¾æ—¶å†æŒ‰ IP åˆ¤æ–­ï¼‰ã€‚è¿™å¯ä»¥é¿å…ä¸å¿…è¦çš„ DNS æŸ¥è¯¢ï¼Œæé«˜åŒ¹é…é€Ÿåº¦ï¼Œå»ºè®®å‡¡æ˜¯ IP è§„åˆ™éƒ½åŠ ä¸Š `no-resolve`ã€‚

---

## 3.9 æœ€ä½³å®è·µæ€»ç»“

**é…ç½®ç»„ç»‡åŸåˆ™ï¼š**

ä»£ç†ç»„è®¾è®¡è¦éµå¾ª"æ¼æ–—å‹"ç»“æ„ï¼šé¡¶å±‚æ˜¯æ€»å…¥å£ï¼ˆæ‰‹åŠ¨é€‰æ‹©ï¼‰ï¼Œä¸­å±‚æ˜¯åœ°åŒºç»„ï¼ˆè‡ªåŠ¨æµ‹é€Ÿï¼‰ï¼Œåº•å±‚æ˜¯åŠŸèƒ½ç»„ï¼ˆæµåª’ä½“ã€AIã€ç”µæŠ¥ç­‰ï¼‰ï¼Œæœ€åæ˜¯å…œåº•ç»„ã€‚æ¯ä¸€å±‚éƒ½è¦æœ‰æ˜ç¡®çš„èŒè´£ã€‚

**è§„åˆ™é¡ºåºåŸåˆ™ï¼š**

å§‹ç»ˆæŠŠæœ€ç²¾ç¡®çš„è§„åˆ™æ”¾åœ¨æœ€å‰é¢ã€‚å¹¿å‘Šæ‹¦æˆªæœ€ä¼˜å…ˆï¼ˆé˜²æ­¢å¹¿å‘Šè¯·æ±‚è§¦å‘åç»­è§„åˆ™æµªè´¹èµ„æºï¼‰ï¼›ç‰¹å®šæœåŠ¡ï¼ˆAIã€æµåª’ä½“ã€ç”µæŠ¥ï¼‰æ¬¡ä¹‹ï¼›å›½å†…è§„åˆ™å†æ¬¡ä¹‹ï¼›æœ€åæ‰æ˜¯é€šé…å…œåº•ã€‚

**DNS åŸåˆ™ï¼š**

æ°¸è¿œä¸è¦æŠŠå›½å¤–åŸŸåçš„è§£æäº¤ç»™å›½å†… DNSï¼Œæ°¸è¿œä¸è¦æŠŠå›½å†…åŸŸåçš„è§£æç»•é“å›½å¤–ã€‚`nameserver-policy` æ˜¯æœ€ç²¾ç»†çš„æ§åˆ¶æ‰‹æ®µï¼Œå»ºè®®è¿›é˜¶ç”¨æˆ·æŒæ¡ã€‚

**æ€§èƒ½åŸåˆ™ï¼š**

`rule-providers` ä¼˜å…ˆä½¿ç”¨ `.mrs` æ ¼å¼ï¼ˆæ¯” YAML å¿« 10 å€ä»¥ä¸Šï¼‰ã€‚ä»£ç†ç»„çš„å¥åº·æ£€æŸ¥ `lazy: true` å¯ä»¥èŠ‚çœä¸å¿…è¦çš„æ¢æµ‹è¯·æ±‚ã€‚TUN æ¨¡å¼çš„åè®®æ ˆé€‰ `mixed` å¹³è¡¡æ€§èƒ½ä¸å…¼å®¹æ€§ã€‚

**å®‰å…¨åŸåˆ™ï¼š**

`external-controller` å¦‚æœå¼€æ”¾åˆ°å±€åŸŸç½‘ï¼ˆ`0.0.0.0:9090`ï¼‰ï¼ŒåŠ¡å¿…è®¾ç½® `secret`ã€‚èŠ‚ç‚¹é…ç½®ä¸­ä¸è¦éšæ„å¼€å¯ `skip-cert-verify: true`ï¼Œè¿™ä¼šä½¿ä½ çš„æµé‡æš´éœ²åœ¨ä¸­é—´äººæ”»å‡»é£é™©ä¹‹ä¸‹ã€‚

---

## é™„å½•ï¼šæ¨èçš„è§„åˆ™é›†æ¥æº

| è§„åˆ™é›† | åœ°å€ | é€‚ç”¨åœºæ™¯ |
|--------|------|----------|
| MetaCubeX å®˜æ–¹è§„åˆ™é›† | `fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/` | ä¸»åŠ›è§„åˆ™é›†ï¼Œæ ¼å¼å…¨ï¼Œæ›´æ–°åŠæ—¶ |
| anti-AD å¹¿å‘Šè¿‡æ»¤ | `anti-ad.net/clash.yaml` | å¹¿å‘Š/è¿½è¸ªæ‹¦æˆª |
| privacy-protection-tools | `github.com/privacy-protection-tools/anti-AD` | éšç§ä¿æŠ¤ |
| ACL4SSR | `github.com/ACL4SSR/ACL4SSR` | ç¤¾åŒºç»´æŠ¤ï¼Œè¦†ç›–é¢å¹¿ |
| blackmatrix7 | `github.com/blackmatrix7/ios_rule_script` | åˆ†ç±»è¯¦ç»†ï¼Œé€‚åˆé«˜åº¦å®šåˆ¶ |

---

> **æœ€åä¸€å¥è¯ï¼š** é…ç½®æ–‡ä»¶æ²¡æœ‰"æ ‡å‡†ç­”æ¡ˆ"ï¼Œåªæœ‰æœ€é€‚åˆä½ ä½¿ç”¨åœºæ™¯çš„ç­”æ¡ˆã€‚ä»å°ç™½çš„æœ€å°é…ç½®å‡ºå‘ï¼Œåœ¨æ¯ä¸€æ¬¡"è¿™ä¸ªä¸å¯¹åŠ²"ä¸­ç†è§£ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œé€æ­¥å åŠ åŠŸèƒ½ï¼Œæ¯”ä»ä¸€å¼€å§‹å°±æŠ„ä¸€ä»½å¤æ‚é…ç½®ç„¶åå®Œå…¨ä¸æ‡‚å®ƒè¦å¥åº·å¾—å¤šã€‚

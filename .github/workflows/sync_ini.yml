name: Sync INI Configs
on:
  schedule:
    # åŒ—äº¬æ—¶é—´æ¯å¤©æ—©ä¸Š 8:00 (UTC 0:00)
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  download-and-update:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Prepare Directories
        run: |
          rm -rf Overwrite
          mkdir -p Overwrite

      - name: Download INI Files
        run: |
          # å®šä¹‰ä¸‹è½½åˆ—è¡¨
          urls=(
            # ==============================
            # 1. ä¹‹å‰æä¾›çš„æ–°é¡¹ç›®
            # ==============================
            "https://raw.githubusercontent.com/szkane/ClashRuleSet/main/Clash/kclash.ini"
            "https://raw.githubusercontent.com/liandu2024/clash/main/Cash-All.ini"
            "https://raw.githubusercontent.com/liandu2024/clash/main/Clash-Full.ini"
            "https://raw.githubusercontent.com/liandu2024/clash/main/Clash-LIAN.ini"
            "https://raw.githubusercontent.com/liandu2024/clash/main/Clash-S01.ini"
            "https://raw.githubusercontent.com/liandu2024/clash/main/Clash-mini.ini"
            "https://raw.githubusercontent.com/liandu2024/clash/main/proxy/clash-all-globe-noicon.ini"
            "https://raw.githubusercontent.com/juewuy/ShellCrash/dev/rules/ShellClash.ini"
            "https://raw.githubusercontent.com/juewuy/ShellCrash/dev/rules/ShellClash_Mini.ini"
            "https://raw.githubusercontent.com/juewuy/ShellCrash/dev/rules/ShellClash_Block.ini"
            "https://raw.githubusercontent.com/juewuy/ShellCrash/dev/rules/ShellClash_Nano.ini"
            "https://raw.githubusercontent.com/juewuy/ShellCrash/dev/rules/ShellClash_Full.ini"
            "https://raw.githubusercontent.com/juewuy/ShellCrash/dev/rules/ShellClash_Full_Block.ini"
            "https://raw.githubusercontent.com/juewuy/ShellCrash/dev/rules/lhie1_clash.ini"
            "https://raw.githubusercontent.com/juewuy/ShellCrash/dev/rules/lhie1_dler.ini"
            "https://raw.githubusercontent.com/juewuy/ShellCrash/dev/rules/ACL4SSR_Online_Mini_MultiCountry.ini"
            "https://raw.githubusercontent.com/juewuy/ShellCrash/dev/rules/ACL4SSR_BackCN.ini"
            "https://raw.githubusercontent.com/juewuy/ShellCrash/dev/rules/ACL4SSR_WithGFW.ini"
            "https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/config/ACL4SSR_Online.ini"
            "https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/config/ACL4SSR_Online_Mini_MultiMode_CF.ini"
            "https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/config/ACL4SSR_Online_Mini_NoAuto_CF.ini"
            "https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/config/ACL4SSR_Online_MultiCountry.ini"
            "https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/config/ACL4SSR_Online_MultiCountry_CF.ini"
            "https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/config/ACL4SSR_Online_Full.ini"
            "https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/config/ACL4SSR_Online_Full_CF.ini"
            "https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/config/ACL4SSR_Online_Full_MultiMode.ini"
            "https://raw.githubusercontent.com/DustinWin/ruleset_geodata/master/rule_templates/DustinWin_Full.ini"
            "https://raw.githubusercontent.com/DustinWin/ruleset_geodata/master/rule_templates/DustinWin_Full_NoAds.ini"
            "https://raw.githubusercontent.com/DustinWin/ruleset_geodata/master/rule_templates/DustinWin_Lite.ini"
            "https://raw.githubusercontent.com/DustinWin/ruleset_geodata/master/rule_templates/DustinWin_Lite_NoAds.ini"
            "https://raw.githubusercontent.com/DustinWin/ruleset_geodata/master/rule_templates/DustinWin_Blacklist_NoAds.ini"
            "https://raw.githubusercontent.com/DustinWin/ruleset_geodata/master/rule_templates/DustinWin_Light.ini"
            "https://raw.githubusercontent.com/DustinWin/ruleset_geodata/master/rule_templates/DustinWin_Nano.ini"

            # ==============================
            # 2. è¡¥å……æå–ï¼šé€šç”¨ (General)
            # ==============================
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Full_NoAuto.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Full_AdblockPlus.ini"
            "https://raw.githubusercontent.com/youshandefeiyang/webcdn/main/SONY.ini"
            "https://raw.githubusercontent.com/WC-Dream/ACL4SSR/WD/Clash/config/ACL4SSR_Online_Full_Dream.ini"
            "https://raw.githubusercontent.com/WC-Dream/ACL4SSR/WD/Clash/config/ACL4SSR_Mini_Dream.ini"
            "https://raw.githubusercontent.com/justdoiting/ClashRule/main/GeneralClashRule.ini"
            "https://raw.githubusercontent.com/cutethotw/ClashRule/main/GeneralClashRule.ini"

            # ==============================
            # 3. è¡¥å……æå–ï¼šACLè§„åˆ™ (ACL Rules)
            # ==============================
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_NoAuto.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_AdblockPlus.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_MultiCountry.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_NoReject.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Mini_NoAuto.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Full.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Full_Google.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Full_MultiMode.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Full_Netflix.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Mini.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Mini_AdblockPlus.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Mini_Fallback.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Mini_MultiCountry.ini"
            "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Mini_MultiMode.ini"

            # ==============================
            # 4. è¡¥å……æå–ï¼šå…¨ç½‘æœé›†è§„åˆ™ (Collected Rules)
            # ==============================
            "https://raw.githubusercontent.com/flyhigherpi/merlinclash_clash_related/master/Rule_config/ZHANG.ini"
            "https://raw.githubusercontent.com/xiaoshenxian233/cool/rule/complex.ini"
            "https://subweb.s3.fr-par.scw.cloud/RemoteConfig/special/phaors.ini"
            "https://raw.githubusercontent.com/flyhigherpi/merlinclash_clash_related/master/Rule_config/ZHANG_Area_Fallback.ini"
            "https://raw.githubusercontent.com/flyhigherpi/merlinclash_clash_related/master/Rule_config/ZHANG_Area_Urltest.ini"
            "https://raw.githubusercontent.com/flyhigherpi/merlinclash_clash_related/master/Rule_config/ZHANG_Area_NoAuto.ini"
            "https://raw.githubusercontent.com/OoHHHHHHH/ini/master/config.ini"
            "https://raw.githubusercontent.com/OoHHHHHHH/ini/master/cfw-tap.ini"
            "https://raw.githubusercontent.com/lhl77/sub-ini/main/tsutsu-full.ini"
            "https://raw.githubusercontent.com/lhl77/sub-ini/main/tsutsu-mini-gfw.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/connershua_new.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/connershua_backtocn.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/lhie1_clash.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/lhie1_dler.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/ehpo1_main.ini"
            "https://raw.nameless13.com/api/public/dl/ROzQqi2S/white.ini"
            "https://raw.nameless13.com/api/public/dl/ptLeiO3S/mayinggfw.ini"
            "https://raw.nameless13.com/api/public/dl/FWSh3dXz/easy3.ini"
            "https://raw.nameless13.com/api/public/dl/L_-vxO7I/youtube.ini"
            "https://raw.nameless13.com/api/public/dl/zKF9vFbb/easy.ini"
            "https://raw.nameless13.com/api/public/dl/E69bzCaE/easy2.ini"
            "https://raw.nameless13.com/api/public/dl/XHr0miMg/ipip.ini"
            "https://raw.nameless13.com/api/public/dl/BBnfb5lD/MAYINGVIP.ini"
            "https://raw.githubusercontent.com/Mazeorz/airports/master/Clash/Examine.ini"
            "https://raw.githubusercontent.com/Mazeorz/airports/master/Clash/Examine_Full.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/nzw9314_custom.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/maicoo-l_custom.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/dlercloud_lige_platinum.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/dlercloud_lige_gold.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/dlercloud_lige_silver.ini"
            "https://unpkg.com/proxy-script/config/Clash/clash.ini"
            "https://github.com/UlinoyaPed/ShellClash/raw/master/rules/ShellClash.ini"

            # ==============================
            # 5. è¡¥å……æå–ï¼šå„å¤§æœºåœºè§„åˆ™ (Airport Rules)
            # ==============================
            "https://gist.github.com/jklolixxs/16964c46bad1821c70fa97109fd6faa2/raw/EXFLUX.ini"
            "https://gist.github.com/jklolixxs/32d4e9a1a5d18a92beccf3be434f7966/raw/NaNoport.ini"
            "https://gist.github.com/jklolixxs/dfbe0cf71ffc547557395c772836d9a8/raw/CordCloud.ini"
            "https://gist.github.com/jklolixxs/e2b0105c8be6023f3941816509a4c453/raw/BigAirport.ini"
            "https://gist.github.com/jklolixxs/9f6989137a2cfcc138c6da4bd4e4cbfc/raw/PaoLuCloud.ini"
            "https://gist.github.com/jklolixxs/fccb74b6c0018b3ad7b9ed6d327035b3/raw/WaveCloud.ini"
            "https://gist.github.com/jklolixxs/bfd5061dceeef85e84401482f5c92e42/raw/JiJi.ini"
            "https://gist.github.com/jklolixxs/6ff6e7658033e9b535e24ade072cf374/raw/SJ.ini"
            "https://gist.github.com/jklolixxs/24f4f58bb646ee2c625803eb916fe36d/raw/ImmTelecom.ini"
            "https://gist.github.com/jklolixxs/b53d315cd1cede23af83322c26ce34ec/raw/AmyTelecom.ini"
            "https://subweb.s3.fr-par.scw.cloud/RemoteConfig/customized/convenience.ini"
            "https://gist.github.com/jklolixxs/ff8ddbf2526cafa568d064006a7008e7/raw/Miaona.ini"
            "https://gist.github.com/jklolixxs/df8fda1aa225db44e70c8ac0978a3da4/raw/Foo&Friends.ini"
            "https://gist.github.com/jklolixxs/b1f91606165b1df82e5481b08fd02e00/raw/ABCloud.ini"
            "https://raw.githubusercontent.com/SleepyHeeead/subconverter-config/master/remote-config/customized/xianyu.ini"
            "https://subweb.oss-cn-hongkong.aliyuncs.com/RemoteConfig/customized/convenience.ini"
            "https://raw.githubusercontent.com/Mazeorz/airports/master/Clash/SSRcloud.ini"
            "https://raw.githubusercontent.com/Mazetsz/ACL4SSR/master/Clash/config/V2rayPro.ini"
            "https://raw.githubusercontent.com/Mazeorz/airports/master/Clash/V2Pro.ini"
            "https://raw.githubusercontent.com/Mazeorz/airports/master/Clash/Stitch.ini"
            "https://raw.githubusercontent.com/Mazeorz/airports/master/Clash/Stitch-Balance.ini"
            "https://raw.githubusercontent.com/SleepyHeeead/subconverter-config/master/remote-config/customized/maying.ini"
            "https://subweb.s3.fr-par.scw.cloud/RemoteConfig/customized/ytoo.ini"
            "https://raw.nameless13.com/api/public/dl/M-We_Fn7/w8ves.ini"
            "https://raw.githubusercontent.com/SleepyHeeead/subconverter-config/master/remote-config/customized/nyancat.ini"
            "https://subweb.s3.fr-par.scw.cloud/RemoteConfig/customized/nexitally.ini"
            "https://raw.githubusercontent.com/SleepyHeeead/subconverter-config/master/remote-config/customized/socloud.ini"
            "https://raw.githubusercontent.com/SleepyHeeead/subconverter-config/master/remote-config/customized/ark.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/n3ro_optimized.ini"
            "https://gist.githubusercontent.com/tindy2013/1fa08640a9088ac8652dbd40c5d2715b/raw/scholar_optimized.ini"
            "https://subweb.s3.fr-par.scw.cloud/RemoteConfig/customized/flower.ini"

            # ==============================
            # 6. è¡¥å……æå–ï¼šç‰¹æ®Š (Special)
            # ==============================
            "https://raw.githubusercontent.com/SleepyHeeead/subconverter-config/master/remote-config/special/netease.ini"
            "https://raw.githubusercontent.com/SleepyHeeead/subconverter-config/master/remote-config/special/basic.ini"
          )

          for url in "${urls[@]}"; do
            # 1. è‡ªåŠ¨åˆ†ç±»é€»è¾‘
            # å¦‚æžœæ˜¯ GitHub/Gist é“¾æŽ¥ï¼Œæå–ç”¨æˆ·å (è·¯å¾„çš„ç¬¬4éƒ¨åˆ†)
            # å¦‚æžœæ˜¯å…¶ä»–åŸŸå (å¦‚ nameless13.com)ï¼Œç›´æŽ¥ä½¿ç”¨åŸŸåä½œä¸ºæ–‡ä»¶å¤¹
            if [[ "$url" == *"github"* ]]; then
              author=$(echo "$url" | cut -d '/' -f 4)
            else
              author=$(echo "$url" | awk -F/ '{print $3}')
            fi
            
            # 2. æå–æ–‡ä»¶å
            filename=$(basename "$url")

            # 3. åˆ›å»ºç›®å½•
            target_dir="Overwrite/$author"
            mkdir -p "$target_dir"

            # 4. ä¸‹è½½æ–‡ä»¶ (å¿½ç•¥ SSL é”™è¯¯ï¼Œè®¾ç½®è¶…æ—¶ï¼Œé™é»˜æ¨¡å¼ä½†æ˜¾ç¤ºé”™è¯¯)
            echo "Downloading $filename -> $target_dir"
            wget -q --no-check-certificate --timeout=15 --tries=2 -O "$target_dir/$filename" "$url" || echo "âš ï¸ Failed to download: $url"
          done

      - name: Generate README Tree
        run: |
          cd Overwrite
          echo "# ðŸ“‚ Overwrite Config Collection" > README.md
          echo "" >> README.md
          echo "Last Updated: $(date "+%Y-%m-%d %H:%M:%S") (Beijing Time)" >> README.md
          echo "" >> README.md
          echo "## ðŸ“Š File Structure" >> README.md
          echo "" >> README.md
          echo "\`\`\`text" >> README.md
          
          # ç”Ÿæˆæ ‘çŠ¶ç»“æž„
          find . -maxdepth 2 -not -path '*/.*' -not -name 'README.md' | sort | sed 's|[^/]*/|- |g;s/^/  /' >> README.md
          
          echo "\`\`\`" >> README.md
          cd ..

      - name: Commit and Push
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Sync all INI configs [$(date +'%Y-%m-%d')]"
          file_pattern: Overwrite/*
          skip_dirty_check: false
